{% extends 'bootstrap/base.html' %}
{% block scripts %}
	{{ super() }}
	{{ datepicker.loader() }} {# to load jQuery-ui #}
	{{ datepicker.picker(id=".dp") }}
{% endblock %}
{% block content %}
	{% with messages = get_flashed_messages(with_categories=true) %}
	  	{% if messages %}
		    <ul class=flashes>
			    {% for category, message in messages %}
			    	<li class="alert alert={{ category }}">{{ message }}</li>
			    {% endfor %}
		    </ul>
	  	{% endif %}
	{% endwith %}
	<h1>ISSUE A BOOK TO A BORROWER</h1>
	<!-- <form method="POST" action="/book_issue/"> -->
	<div class="form-group">
		<label for="search">Enter Book Code, Name</label>
		<input type="text" name="search" id="search" placeholder="Search.." required>
		<!-- <button type="submit" class="btn btn-primary">GO</button> -->
	</div>
	<!-- </form> -->
	{% if data.book_entry_list %}
		{% for book in data.book_entry_list %}
			{{book.book_code}} {{book.name}} {{book.author}}<br>
		{% endfor %}
	{% endif %}

	{% if data.book_entry_obj %}
		<form method="POST" action="/book_issue/">
			<h1>Book Details</h1>
			Book Name & code :- {{data.book_entry_obj.name}} &nbsp;&nbsp; {{data.book_entry_obj.book_code}}<br>
			Author & Publisher :- {{data.book_entry_obj.author}} &nbsp;&nbsp; {{data.book_entry_obj.publisher}}<br>
			Look for this book :- in shelf number {{data.book_entry_obj.shelf_name.name}}
			<div class="form-group">
				<input type="hidden" class="form-control" name="book_code" value="{{data.book_entry_obj.book_code}}"><br>
			</div>
			<h1>Borrower Details</h1>
			<div class="form-group">
				<label for="name">Borrower Name*</label><br>
				<input type="text" class="form-control" name="name" required><br>
			</div>
			<div class="form-group">
				<label for="address">Borrower Address*</label><br>
				<input type="text" class="form-control" name="address" required><br>
			</div>
			<div class="form-group">
				<label for="cell_no">Borrower Cell No*</label><br>
				<input type="tel" class="form-control" id="cell_no" name="cell_no" placeholder="1234567890" pattern="[0-9]{10}" required><br>
			</div>
			<div class="form-group">
				<label for="email">Borrower Email</label><br>
				<input type="email" class="form-control" name="email"><br>
			</div>
			<h1>Book Issue & Return date</h1>
			<div class="form-group">
				<label for="issue_date">Issue Date*</label><br>
				<input type="date" id="issue_date" class="form-control" name="issue_date" value="{{data.issue_date}}" required readonly><br>
			</div>
			<div class="form-group">
				<label for="return_date">Return Date*</label><br>
				<input type="date" id="return_date" class="form-control" name="return_date" value="{{data.return_date}}" required readonly><br>
			</div>
			<a href="/"><button>BACK</button></a>
			<button type="submit" class="btn btn-primary">ISSUE</button>
			<br><br>
		</form>
	{% endif %}
	{% block script %}
	    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	    <script type="text/javascript">
	    	$("#search").on('change', function() {
	    		var searchvalue = $('#search').val();
				console.log(searchvalue);
				$.ajax({
		            type: "POST",
		            url: "/book_search/",
		            contentType: 'application/json;charset=UTF-8',
		            data: JSON.stringify(data),       
		            success: function(resp){
		            	alert(resp);
		            }
		        });
	    	});
			// // $("#update_detail").click(function(){
			// $(".search").on('change', function postinput(){
			// 	var searchvalue = $(this).val();
			// 	console.log(searchvalue);
				// alert(searchvalue);
				// username = document.getElementById("edit_username").value;
		  //   	first_name = document.getElementById("edit_first_name").value;
		  //   	last_name = document.getElementById("edit_last_name").value;
		  //   	email = document.getElementById("edit_email").value;
		  //   	birth_date = document.getElementById("edit_birth_day").value;
		  //   	department = document.getElementById("edit_department").value;
				// console.log(username, first_name, last_name, email, birth_date, department)
				// var data = {
				// 	'searchvalue': searchvalue,
				// }
				// $("#employee_detail_edit").hide();
				// $("#employee_detail").show();

		    // 	$.ajax({
		    //         type: "POST",
		    //         url: "/update_employee_detail/",
		    //         contentType: 'application/json;charset=UTF-8',
		    //         data: JSON.stringify(data),       
		    //         success: function(resp){
		    //         	if(JSON.parse(resp)['status']){ // true  not error 
		    //         		console.log("Start");
		    //         		if (JSON.parse(resp)['username'][0]){
		    //         			$("#username").text(JSON.parse(resp)['username'][0]);
		    //         			$("#username").attr("value", JSON.parse(resp)['username'][0]);
		    //         		}
						// 	if (JSON.parse(resp)['first_name'][0]) {
						// 		$("#first_name").text(JSON.parse(resp)['first_name'][0]);
		    //         			$("#first_name").attr("value", JSON.parse(resp)['first_name'][0]);
						// 	}
						// 	if (JSON.parse(resp)['last_name'][0]) {
						// 		$("#last_name").text(JSON.parse(resp)['last_name'][0]);
		    //         			$("#last_name").attr("value", JSON.parse(resp)['last_name'][0]);
						// 	}
					 //    	if (JSON.parse(resp)['email'][0]) {
					 //    		$("#email").text(JSON.parse(resp)['email'][0]);
		    //         			$("#email").attr("value", JSON.parse(resp)['email'][0]);
					 //    	}
					 //    	// try {
					 //    	if (JSON.parse(resp)['birth_date'][0]) {
					 //    		$("#birth_date").text(JSON.parse(resp)['birth_date'][0]);
	     //        				$("#birth_date").attr("value", JSON.parse(resp)['birth_date'][0]);
					 //    	}
						//     // } catch(e) {
						//     // 	console.log("Date not store!")
						//     // }
					 //    	if (JSON.parse(resp)['department'][0]) {
					 //    		$("#department").text(JSON.parse(resp)['department'][0]);
		    //         			$("#department").attr("value", JSON.parse(resp)['department'][0]);
					 //    	}
					 //    	console.log("Done");
						// }
						// else 
						// {
						// 	console.log("error");
						// 	alert(JSON.parse(resp)['error'])
						// }
		    //         }
		    //     });

			// });
	    </script>
	{% endblock script %}
{% endblock content %}